<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="SS3 Development Team">
<meta name="dcterms.date" content="2025-06-30">

<title>Developing your first Stock Synthesis model – Stock Synthesis (SS3)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../qmds/images/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-17491c833ff51a6fd9cabbabe95c66ba.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Stock Synthesis (SS3)</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ss3-user-manuals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-journal-code" role="img" aria-label="User Manual">
</i> 
 <span class="menu-text">SS3 User Manuals</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ss3-user-manuals">    
        <li>
    <a class="dropdown-item" href="https://nmfs-ost.github.io/ss3-doc/SS330_User_Manual_release.html" target="_blank">
 <span class="dropdown-text">HTML Version</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nmfs-ost/ss3-source-code/releases/latest/download/SS330_User_Manual.pdf">
 <span class="dropdown-text">PDF Version (downloads on click)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/user_manual.html">
 <span class="dropdown-text">Citing the SS3 User Manual</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-getting-started-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-terminal" role="img" aria-label="Tutorials">
</i> 
 <span class="menu-text">Getting Started Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-getting-started-tutorials">    
        <li>
    <a class="dropdown-item" href="../qmds/getting_started_ss3.html">
 <span class="dropdown-text">Getting Started with Stock Synthesis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/ss3_model_tips.html">
 <span class="dropdown-text">Developing your first Stock Synthesis model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/ss3_setup_decisions.html">
 <span class="dropdown-text">Important SS3 Set-up Decisions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-model-feature-vignettes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-person-workspace" role="img" aria-label="Vignette Workspace">
</i> 
 <span class="menu-text">Model Feature Vignettes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-model-feature-vignettes">    
        <li>
    <a class="dropdown-item" href="../qmds/start_year_considerations.html">
 <span class="dropdown-text">Start Year Considerations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/predator.html">
 <span class="dropdown-text">Predators</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/settlement_timing.html">
 <span class="dropdown-text">Settlement Timing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/phases.html">
 <span class="dropdown-text">Guidance on Phases</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/platoons.html">
 <span class="dropdown-text">Platoons</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/richards_growth_curve.html">
 <span class="dropdown-text">Notes on Richards growth in Stock Synthesis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../qmds/webinars.html"> <i class="bi bi-webcam" role="img" aria-label="Webinars">
</i> 
<span class="menu-text">SS3 Webinar Series</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/nmfs-ost/ss3-website">
 <span class="dropdown-text">SS3 Website GitHub Repository</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nmfs-ost/ss3-doc">
 <span class="dropdown-text">User Manual GitHub Repository</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nmfs-ost/ss3-source-code">
 <span class="dropdown-text">Stock Synthesis GitHub Repository</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#scope" id="toc-scope" class="nav-link active" data-scroll-target="#scope">Scope</a></li>
  <li><a href="#how-to-create-new-ss3-models" id="toc-how-to-create-new-ss3-models" class="nav-link" data-scroll-target="#how-to-create-new-ss3-models">How to create new SS3 models</a></li>
  <li><a href="#guidance-on-model-specification" id="toc-guidance-on-model-specification" class="nav-link" data-scroll-target="#guidance-on-model-specification">Guidance on model specification</a></li>
  <li><a href="#phases-in-ss3-and-admb" id="toc-phases-in-ss3-and-admb" class="nav-link" data-scroll-target="#phases-in-ss3-and-admb">Phases in SS3 and ADMB</a></li>
  <li><a href="#basic-debugging-use-echoinput.sso-and-warning.sso" id="toc-basic-debugging-use-echoinput.sso-and-warning.sso" class="nav-link" data-scroll-target="#basic-debugging-use-echoinput.sso-and-warning.sso">Basic debugging: use echoinput.sso and warning.sso</a></li>
  <li><a href="#visualizing-results" id="toc-visualizing-results" class="nav-link" data-scroll-target="#visualizing-results">Visualizing results</a></li>
  <li><a href="#proposed-workflow-for-arriving-at-a-final-model" id="toc-proposed-workflow-for-arriving-at-a-final-model" class="nav-link" data-scroll-target="#proposed-workflow-for-arriving-at-a-final-model">Proposed workflow for arriving at a “final” model</a>
  <ul class="collapse">
  <li><a href="#first-runs-without-estimation" id="toc-first-runs-without-estimation" class="nav-link" data-scroll-target="#first-runs-without-estimation">First runs without estimation</a></li>
  <li><a href="#runs-estimating-some-parameters" id="toc-runs-estimating-some-parameters" class="nav-link" data-scroll-target="#runs-estimating-some-parameters">Runs estimating some parameters</a></li>
  <li><a href="#runs-estimating-all-parameters" id="toc-runs-estimating-all-parameters" class="nav-link" data-scroll-target="#runs-estimating-all-parameters">Runs estimating all parameters</a></li>
  </ul></li>
  <li><a href="#advanced-debugging" id="toc-advanced-debugging" class="nav-link" data-scroll-target="#advanced-debugging">Advanced debugging</a>
  <ul class="collapse">
  <li><a href="#if-the-residuals-have-substantial-patterns" id="toc-if-the-residuals-have-substantial-patterns" class="nav-link" data-scroll-target="#if-the-residuals-have-substantial-patterns">If the residuals have substantial patterns</a></li>
  <li><a href="#if-ss3-runs-but-there-is-a-large-gradient-at-the-end" id="toc-if-ss3-runs-but-there-is-a-large-gradient-at-the-end" class="nav-link" data-scroll-target="#if-ss3-runs-but-there-is-a-large-gradient-at-the-end">If SS3 runs, but there is a large gradient at the end</a></li>
  <li><a href="#if-the-hessian-does-not-invert" id="toc-if-the-hessian-does-not-invert" class="nav-link" data-scroll-target="#if-the-hessian-does-not-invert">If the Hessian does not invert</a></li>
  </ul></li>
  <li><a href="#advanced-admb-run-options-mcmc-adnuts" id="toc-advanced-admb-run-options-mcmc-adnuts" class="nav-link" data-scroll-target="#advanced-admb-run-options-mcmc-adnuts">Advanced ADMB run options (MCMC, adnuts)</a></li>
  <li><a href="#some-questions-to-consider-during-model-development" id="toc-some-questions-to-consider-during-model-development" class="nav-link" data-scroll-target="#some-questions-to-consider-during-model-development">Some questions to consider during model development</a>
  <ul class="collapse">
  <li><a href="#does-my-model-model-make-sense" id="toc-does-my-model-model-make-sense" class="nav-link" data-scroll-target="#does-my-model-model-make-sense">Does my model model make sense?</a></li>
  <li><a href="#does-my-model-fit-well" id="toc-does-my-model-fit-well" class="nav-link" data-scroll-target="#does-my-model-fit-well">Does my model fit well?</a></li>
  <li><a href="#does-my-data-weighting-make-sense" id="toc-does-my-data-weighting-make-sense" class="nav-link" data-scroll-target="#does-my-data-weighting-make-sense">Does my data weighting make sense?</a></li>
  <li><a href="#did-i-fix-variation-in-recruitment-correctly" id="toc-did-i-fix-variation-in-recruitment-correctly" class="nav-link" data-scroll-target="#did-i-fix-variation-in-recruitment-correctly">Did I fix variation in recruitment correctly?</a></li>
  </ul></li>
  <li><a href="#where-to-get-additional-help" id="toc-where-to-get-additional-help" class="nav-link" data-scroll-target="#where-to-get-additional-help">Where to get additional help</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Developing your first Stock Synthesis model</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>SS3 Development Team </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="scope" class="level1">
<h1>Scope</h1>
<p>The developing your first SS3 model guide teaches users how to develop a basic Stock Synthesis model. We assume that these users have had previous population dynamics modeling experience and already understand how to run an existing SS3 model.</p>
<p>If you are a new SS3 user who is not yet comfortable running an SS3 model, we suggest trying to run an example working model using advice in the <a href="qmds/getting_started_ss3.qmd">Getting Started Guide</a> before attempting to develop and run your own model as outlined in this guide.</p>
<p>By the end of using this guide, you should be able to:</p>
<ol type="1">
<li>Develop your own SS3 model development workflow based on the tools and methods suggested</li>
<li>Find information on the required inputs for different model specifications</li>
<li>Understand how to use phases within an SS3 model</li>
<li>Debug basic issues with input in Stock Synthesis models and identify when there are more advanced model problems</li>
</ol>
</section>
<section id="how-to-create-new-ss3-models" class="level1">
<h1>How to create new SS3 models</h1>
<p>There are many potential workflows for developing a new SS3 model, but a common technique is to start with an existing model and change it in a piece-wise fashion. The basic technique is:</p>
<ol type="1">
<li>Find an existing working model (perhaps one of the SS3 example models available in the <a href="https://github.com/nmfs-ost/ss3-user-examples">user-examples repository</a> or perhaps a model more similar in form to the model you plan to create).</li>
<li>Edit portions of the model and try running as you go to check that your inputs can be read correctly by SS3 and make logical sense (tip: use options <code>-stopph 0 -nohess</code> to reduce run time with each iteration of checking inputs by not estimating anything and not inverting the hessian).</li>
</ol>
<p>Some commonly used tools for editing the SS3 input files are:</p>
<ol type="1">
<li><strong>Your favorite text editor</strong>.</li>
<li><strong>The <code>SS_read()</code> and <code>SS_write()</code> functions in the R package <a href="https://github.com/r4ss/r4ss">{r4ss}</a></strong>. These functions allow you to read in SS3 input files to R, manipulate them from within R, then write them out to a file. The <a href="https://r4ss.github.io/r4ss/vignettes/r4ss-intro-vignette.html#scripting-stock-synthesis-workflows-with-r4ss">{r4ss} vignette</a> demonstrates how to use these functions</li>
<li><strong>Stock Assessment Continuum Tool</strong>. Available through github at https://github.com/shcaba/SS-DL-tool.</li>
<li><a href="https://github.com/nmfs-ost/ssi"><strong>Stock Synthesis Interface (SSI; the SS3 GUI)</strong></a>. The SSI allows you to read in a model, performs some checks to ensure valid inputs, make modifications to the model, and offers visualizations of inputs. You can also run models from SSI. Note that SSI is not maintained for Stock Synthesis versions after v.3.30.21.</li>
</ol>
</section>
<section id="guidance-on-model-specification" class="level1">
<h1>Guidance on model specification</h1>
<p>SS3 has a rich set of features. Some required inputs are conditional on other inputs, so it is important to be mindful that changing an option might result in SS3 expecting a different number of values in the input files than it did previously. Most of the time, these conditional inputs are read right after the option.</p>
<p>The <a href="https://github.com/nmfs-ost/ss3-doc/releases">SS3 user manual</a> can be used as a guide to help you edit your model. Conditional inputs are noted in the manual.</p>
<p>If you are unsure if you got the setup right (e.g., adding the correct number of parameter lines for a chosen catchability setup), try running the model with <code>maxphase = 0</code> in the starter file and ADMB option <code>-nohess</code> (or for SS3 3.30.16 and greater, run the model with command line options <code>-stopph 0 -nohess</code>, no need to change the starter file). If the model run completes, you can compare the control.ss_new file and the first data set in data.ss_new to your SS3 input files to make sure SS3 interpreted the values as intended. If the run exits before completion, you can look at warning.sso and echoinput.sso for clues as to what was wrong with your setup.</p>
<p>For additional help with model specification, please post your questions in the GitHub <a href="https://github.com/nmfs-ost/ss3-source-code/discussions">discussions</a> or on the vlab <a href="https://vlab.noaa.gov/web/stock-synthesis/public-forums">forums</a> (for registered SS3 users) or send an email to the SS3 team at NMFS.Stock.Synthesis@noaa.gov.</p>
</section>
<section id="phases-in-ss3-and-admb" class="level1">
<h1>Phases in SS3 and ADMB</h1>
<p>Phases are used within ADMB to tell the program in what order the parameters should be estimated. For more details about phases in ADMB, see the <a href="http://www.admb-project.org/docs/manuals/">ADMB user manual</a>. ADMB phases can be specified for parameters in SS3.</p>
<p>A <strong>negative phase</strong> indicates that the parameter is not estimated, but specified. Note that all negative phases are equivalent; i.e., there is no difference in how parameters with phases -1 and -99 are dealt with. The exceptions are:</p>
<ul>
<li>-9999, which is a special value within SS3 (see the profilevalues.ss section of the SS3 user manual).</li>
<li>Values more negative than -999 for parameters in the tagging section of the control file.</li>
</ul>
<p>A <strong>positive phase</strong> indicates that the parameter will be estimated. Parameters with a lower positive phase will be estimated before those with a higher positive phase. Which phase should you put an estimated parameter in? While there is variability among analysts and models in how phasing is used, in general, parameters with low positive phases should be for values which define the scale of the population (i.e., <span class="math inline">\(R_{0}\)</span>, natural mortality, steepness, selectivity slope). Parameters for fine-tuning fits to the data are often estimated in later phases (i.e., catchability, growth, and recruitment deviation parameters). Many models use positive phases from about 1 to 5, although it is possible to use higher phasing values.</p>
<p>When a model is run without estimating anything, the phases are ignored; because there is no estimation, running without estimation is like including a negative phase for all parameters.</p>
</section>
<section id="basic-debugging-use-echoinput.sso-and-warning.sso" class="level1">
<h1>Basic debugging: use echoinput.sso and warning.sso</h1>
<p>The most useful tools for debugging SS3 issues are the SS3 output files echoinput.sso and warning.sso. As SS3 runs, it writes back to echoinput.sso. When SS3 exits without finishing, looking at the last contents written to echoinput.sso and comparing it with your input files can provide clues as to where (and possibly why) the run failed. Note that SS3 reads inputs in order and will read them incorrectly if the wrong number of inputs is provided. Any warnings generated during the run are written to warning.sso. The warnings.sso file should always be examined at the end of the run, even if the run was successful, as it includes suggestions for improving the model specification and warnings about common model specification mistakes.</p>
</section>
<section id="visualizing-results" class="level1">
<h1>Visualizing results</h1>
<p>Visualization is helpful as you iteratively develop your model and for presentation of final model results. The output of an SS3 model can be read into <a href="https://github.com/r4ss/r4ss">{r4ss}</a>. The <a href="https://r4ss.github.io/r4ss/vignettes/r4ss-intro-vignette.html">{r4ss} vignette</a> has more information on how to use the {r4ss} R package.</p>
</section>
<section id="proposed-workflow-for-arriving-at-a-final-model" class="level1">
<h1>Proposed workflow for arriving at a “final” model</h1>
<p>It’s important to remember that arriving at a model takes time and many iterations! You should plan on making small revisions, rerunning the model, and looking at how the model has changed with each small revision. Typically, many intermediate model runs are required before you reach a final model. At a minimum, keep notes inside of the run folder or elsewhere regarding the run specific changes. Using version control could also be helpful for tracking model changes. Below, we provide some suggestions on the steps to take as you iterate toward your “final” model.</p>
<section id="first-runs-without-estimation" class="level2">
<h2 class="anchored" data-anchor-id="first-runs-without-estimation">First runs without estimation</h2>
<p>First, check that SS3 reads the input files as intended. Use <code>-stopph 0 -nohess</code> command line options to run the model without estimation. Then examine warning.sso, echoinput.sso, and the .ss_new files produced to see how SS3 interpreted your input files and if it was as you intended.</p>
<p>After you have verified that SS3 is reading your input correctly, you can also consider adjustment to selectivity, growth, and recruitment parameters.</p>
<!-- Probably too many details, but could add to this section: -->
<!-- *In particular, you can check that lnR0 is large enough to support the catch time series. If it is not, it should be adjusted. Note that the depletion fleet controls can be used as an automated approach for this issue.* -->
<!-- *TODO: Add more details about lnR0 - explain why this needs to be done more fully and how to modify the depletion fleet controls.* -->
</section>
<section id="runs-estimating-some-parameters" class="level2">
<h2 class="anchored" data-anchor-id="runs-estimating-some-parameters">Runs estimating some parameters</h2>
<p>Try changing max phase to be greater than 0 (perhaps 2 or 3) to estimate some but not all parameters. Do this by using <code>-stopph x -nohess</code>, where x should the maximum phase desired (e.g., 2 or 3). <code>-nohess</code> is still used to reduce run time. During this stage of model runs, you should try to adjust the model to resolve all major patterns in the residuals. This may include considering and making changes to the model structure.</p>
</section>
<section id="runs-estimating-all-parameters" class="level2">
<h2 class="anchored" data-anchor-id="runs-estimating-all-parameters">Runs estimating all parameters</h2>
<p>Once all major patterns in the residuals have been resolved, try estimating all parameters in the model. Change max phase to include all of your model phases (i.e., equal to or higher than the highest phase specified in your model). You’ll want to do multiple runs for different model refinement purposes at this time:</p>
<ol type="1">
<li>Do one or more run(s) with the hessian estimated to get variance of the recruitment deviations and then use this vector of variances to adjust the bias adjustment ramp (see the <a href="https://nmfs-ost.github.io/ss3-doc/SS330_User_Manual_release.html">SS3 user manual</a> for additional details).</li>
<li>Do runs with or without estimating the Hessian to tune the data weightings.</li>
<li>Run the model multiple times and jitter the starting values (option to jitter is selected in starter.ss). This runs the model with new starting parameter values to determine if a better model fit is possible using different starting values.</li>
</ol>
<p>After these runs, your model should be fine-tuned and ready for final runs.</p>
</section>
</section>
<section id="advanced-debugging" class="level1">
<h1>Advanced debugging</h1>
<p>In this section, we have listed some common problems that you may encounter and some techniques to resolving them within your model.</p>
<section id="if-the-residuals-have-substantial-patterns" class="level2">
<h2 class="anchored" data-anchor-id="if-the-residuals-have-substantial-patterns">If the residuals have substantial patterns</h2>
<p>It is often difficult to pinpoint the cause of residuals that have substantial patterns, but two potential reasons this could happen are unrealistic starting values or poor model specification. If you have residuals with substantial pattern, you can try changing the starting values. If a parameter is not moving from the starting value, there may not be enough information to determine its value and it may be necessary to fix the value in the model. If the parameter does move with different starting values, it is possible that the starting value used before was not reasonable and thus changing the starting value to a reasonable value fixes the issue.</p>
</section>
<section id="if-ss3-runs-but-there-is-a-large-gradient-at-the-end" class="level2">
<h2 class="anchored" data-anchor-id="if-ss3-runs-but-there-is-a-large-gradient-at-the-end">If SS3 runs, but there is a large gradient at the end</h2>
<p>Large gradients are usually reported in warnings.sso file, so this problem should be clear when examining the file after a model run. If this is the case, try the following</p>
<ul>
<li>Examine Report.sso for parameters that are on or near bounds, as these may be the parameters that are causing issues. It depends on the value, but you can consider changing your bounds or the parameters, depending on what seems most plausible given your model.</li>
<li>Examine residuals to identify if there is overall poor lack-of-fit. This may indicate that the ADMB algorithm failed to find the global minimum. Try alternative starting values to attempt to solve this problem. However, it is also possible that there is large disagreement between your model structure and your model file, in which case you may want to reconsider the model specification - perhaps there is an alternative model structure that makes more sense for the population.</li>
</ul>
</section>
<section id="if-the-hessian-does-not-invert" class="level2">
<h2 class="anchored" data-anchor-id="if-the-hessian-does-not-invert">If the Hessian does not invert</h2>
<p>The Hessian information is reported in the Report.sso file, so go to this section to confirm if this is an issue. This is a difficult issue to solve, but considering alternative models may be necessary if the Hessian will not invert.</p>
</section>
</section>
<section id="advanced-admb-run-options-mcmc-adnuts" class="level1">
<h1>Advanced ADMB run options (MCMC, adnuts)</h1>
<p>SS3 models are typically run using maximum likelihood estimation (MLE), but it is possible to run SS3 models using Markov Chain Monte Carlo (MCMC). MCMC is outside the scope of this document, but below are some resources to check out in case you are interested in pursuing it further:</p>
<ol type="1">
<li>See the <a href="http://www.admb-project.org/docs/manuals/">ADMB user manual</a> for more information on using MCMC in ADMB and the section on Running MCMC in the SS3 user manual for more specific information on running MCMC in SS3.</li>
<li>See the <a href="https://github.com/colemonnahan/adnuts">adnuts repository</a> for more information on using the No-U-Turn sampler (NUTS) in ADMB and <a href="https://doi.org/10.1093/icesjms/fsz059">this article by Monnahan et al.&nbsp;(2019)</a> to better understand the benefits of using NUTS for assessment models.</li>
</ol>
</section>
<section id="some-questions-to-consider-during-model-development" class="level1">
<h1>Some questions to consider during model development</h1>
<p>There are many elements to consider in an SS3 model. Below are some questions and considerations that experienced SS3 users have used to check that their model makes sense throughout the iterative model development process.</p>
<section id="does-my-model-model-make-sense" class="level2">
<h2 class="anchored" data-anchor-id="does-my-model-model-make-sense">Does my model model make sense?</h2>
<ul>
<li>Does the biology make sense? Selectivity?</li>
<li>Is the model fitting the indices? Length and age data?</li>
<li>What is the pattern in recruitment?</li>
<li>Does the prior type match what I thought I was specifying?</li>
</ul>
</section>
<section id="does-my-model-fit-well" class="level2">
<h2 class="anchored" data-anchor-id="does-my-model-fit-well">Does my model fit well?</h2>
<ul>
<li><p>The <code>r4ss::SS_output()</code> function prints some very useful diagnostics to the R console window, including a list of the estimated parameters, the estimated value, whether the parameter is hitting a bound, the gradient, and the prior type. Use this (or other SS3 output files) to answer:</p>
<ul>
<li>Did the parameter move from the initial value?</li>
<li>Is the parameter hitting a bound?</li>
<li>Is the parameter gradient low?</li>
</ul></li>
<li><p>Below the parameter estimates that <code>r4ss::SS_output()</code> prints to the console, there is a specific section that highlights the parameters with the highest model gradients. Examining this list might indicate which (if any) parameters may need to be fixed due to lack of information in the data. For example, there may be selectivity parameters included in the list where small changes in the parameter value do not change the model results (or the form of the selectivity).</p></li>
</ul>
</section>
<section id="does-my-data-weighting-make-sense" class="level2">
<h2 class="anchored" data-anchor-id="does-my-data-weighting-make-sense">Does my data weighting make sense?</h2>
<p>The <code>r4ss::SS_output()</code> function prints information on tuning to the R console. This includes tuning information for length and age data that can be used for data weighting when using McAllister-Ianelli weighting (i.e., weighting by the harmonic mean). The <code>r4ss::SS_plots()</code> function creates mean length and ages figures with captions showing the recommended Francis weights for each data source. Even if you are using an alternative data weighting approach (i.e., Francis, Dirichlet, or other), it is always good practice to explore an alternative approach and see how data weighting changes the model.</p>
</section>
<section id="did-i-fix-variation-in-recruitment-correctly" class="level2">
<h2 class="anchored" data-anchor-id="did-i-fix-variation-in-recruitment-correctly">Did I fix variation in recruitment correctly?</h2>
<p>Check the the <span class="math inline">\(\sigma R\)</span> (sigmaR) (i.e., recruitment deviations standard deviation) information. The <span class="math inline">\(\sigma R\)</span> parameter is typically fixed within the model, so if it is not fixed within your model, you should consider whether or not this makes sense for the population and given the quality and quantity of data.</p>
<p>For a fixed value of <span class="math inline">\(\sigma R\)</span>, a section of the output will provide diagnostics to determine if the fixed <span class="math inline">\(\sigma R\)</span> value is capturing the estimated variations in recruitment. The <code>r4ss::SS_output()</code> function will print a recommended value based on the variation in the estimated recruitment deviations that you may want to consider using.</p>
</section>
</section>
<section id="where-to-get-additional-help" class="level1">
<h1>Where to get additional help</h1>
<ul>
<li>Post questions in the GitHub <a href="https://github.com/nmfs-ost/ss3-source-code/discussions">discussions</a> or to the <a href="https://groups.google.com/g/ss3-forum">SS3 User Forum Google Group</a> or send an emails to the team at NMFS.Stock.Synthesis@noaa.gov for assistance.</li>
<li><a href="https://doi.org/10.1016/j.fishres.2021.105959">Carvalho et al.&nbsp;2021</a> contains guidance on developing stock assessments.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>